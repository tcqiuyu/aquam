{% extends "base.html" %}
{% load staticfiles %}

{% block header %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/chart.css' %}"/>
    <!-- D3 -->
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
{% endblock %}

{% block mainbody %}
<div class="container">
    <div class="jumbotron">
        <h2>Water Use Analyzer - Demo</h2>
        <p>This analyzer is an interactive tool designed to fit the user, in this case,
    	an operator or a water management company to anlayze their statistics of water,
    	current and historical to establish a baseline and a trend to improve their water
    	use scenarios significantly. This tool also provides the user to look at
    	Key Performance Indicators (KPIs) such as average horizontal length drilled,
    	average water used per well and bbls water used per horizontal foot,
    	on an annual comparison basis. </p>
    </div>
    
    <h3>Horizontal Wells</h3>
    
    <div id="table-container">
        {% include 'solutions/partial/water-use-table.html'%}
    </div>
    
    <hr>
    
    <div>
        {{ data }}
    </div>
    
    <hr>
    <h3>Analytics</h3>
    <div class="chart" style="with:100%">
        <div id="chart1" style="width:100%; height:500px"></div>
        <div id="chart2" style="width:100%; height:500px"></div>
        <div id="chart3" style="width:100%; height:500px"></div>
        <hr/>
    </div>
{% endblock %}

{% block footer %}
<script type="text/javascript">
    // histogram
	$(document).ready(function() {
	    d3.json("{% url 'get-cubic-fitting'%}", function(error, data) {
	       console.log(data)
	    });
		d3.json("{% url 'get-water-use'%}", function(error, data) {
		    // data
		    values = data["water_use"]
		    //chart
		    var margin = {top:10, right:30, bottom:40, left:50},
		        width = $("#chart1").width() - margin.left - margin.right,
		        height = $("#chart1").height() - margin.top - margin.bottom;
		    var xRange = d3.scale.linear()
		        .domain(d3.extent(values, function(d){ return d; }))
		        .range([0, width]);
		    var data = d3.layout.histogram()
                .bins(10)(values);//xRange.ticks(15)
		    var yRange = d3.scale.linear()
		        .domain([0, d3.max(data, function(d){ return d.y; })])
		        .range([height, 0]);
		    var xAxis = d3.svg.axis()
		        .scale(xRange)
		        .orient("bottom");
		    var yAxis = d3.svg.axis()
                .scale(yRange)
                .orient("left");
		    var svg = d3.select("#chart1").append("svg")
		        .attr("width", width + margin.left + margin.right)
		        .attr("height", height + margin.top + margin.bottom)
		        .append("g")
		        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
		    // set up the bars and text
		    var bar = svg.selectAll(".bar")
                .data(data)
                .enter()
                .append("g")
                .attr("class", "bar")
                .attr("transform", function(d){ return "translate(" + xRange(d.x) + "," + yRange(d.y) + ")";});
		    bar.append("rect")
                .attr("x", 1)
                .attr("width", xRange(data[0].dx) - 1)
                .attr("height", function(d){ return height - yRange(d.y); })
                .attr("fill", "steelblue")
                .on("mouseover", function(){ d3.select(this).attr("fill", "green"); })
                .on("mouseout", function(){ d3.select(this).attr("fill", "steelblue"); });
            bar.append("text")
                .attr("dy", "0.75em")
                .attr("y", 6)
                .attr("x", xRange(data[0].dx/2))
                .attr("text-anchor", "middle")
                .text(function(d){ return d.y; });
            // add the x-axis and x-label
            svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis);
            svg.append("text")
                .attr("class", "xlabel")
                .attr("text-anchor", "middle")
                .attr("x", width/2)
                .attr("y", height + margin.bottom)
                .attr("font-size", 12)
                .text("Water Used per Well");
            // add the y-axis and y-label
            svg.append("g")
                .attr("class", "y axis")
                .attr("transform", "translate(0, 0)")
                .call(yAxis);
            svg.append("text")
                .attr("class", "ylabel")
                .attr("x", 0 - (height/2))
                .attr("y", 0 - margin.left)
                .attr("dy", "1em")
                .attr("transform", "rotate(-90)")
                .attr("text-anchor", "middle")
                .attr("font-size", 12)
                .text("Number of Wells");
		});
	});
</script>
{% endblock %}

{% block footer2 %} {% endblock %}